<div class="tracking-modal-overlay" (click)="onClose()">
    <div class="tracking-modal" (click)="$event.stopPropagation()">
        <!-- Map Section -->
        <div class="map-section">
            <div #mapContainer class="map-container"></div>
            <div class="speed-badge">
                {{ vehicle.licensePlate }} ‚Ä¢ {{ trackingData().speed }}km/h
            </div>
        </div>

        <!-- Info Panel -->
        <div class="info-panel">
            <!-- Header -->
            <div class="panel-header">
                <div class="vehicle-summary">
                    <span class="plate">{{ vehicle.licensePlate }}</span>
                    <app-status-badge [label]="getStatusLabel(vehicle.currentStatus)"
                        [variant]="getStatusVariant(vehicle.currentStatus)" size="small" />
                </div>
                <span class="vehicle-type">{{ vehicle.vehicleType }} ‚Ä¢ {{ vehicle.maxWeightKg }}kg</span>
                <button class="close-btn" (click)="onClose()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button [class.active]="activeTab() === 'info'" (click)="activeTab.set('info')">Th√¥ng tin</button>
                <button [class.active]="activeTab() === 'orders'" (click)="activeTab.set('orders')">ƒê∆°n h√†ng ({{
                    currentOrders().length }})</button>
                <button [class.active]="activeTab() === 'history'" (click)="activeTab.set('history')">L·ªãch
                    tr√¨nh</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                @if (activeTab() === 'info') {
                <!-- Driver -->
                <div class="info-card">
                    <div class="card-label">T√†i x·∫ø</div>
                    <div class="driver-info">
                        <div class="driver-avatar">
                            {{ trackingData().driverName.charAt(0) }}
                        </div>
                        <div class="driver-details">
                            <span class="name">{{ trackingData().driverName }}</span>
                            <span class="phone">{{ trackingData().driverPhone }}</span>
                        </div>
                        <button class="call-btn">üìû</button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-value">{{ trackingData().speed }}</span>
                        <span class="stat-unit">km/h</span>
                        <span class="stat-label">T·ªëc ƒë·ªô</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value">{{ trackingData().fuelLevel }}</span>
                        <span class="stat-unit">%</span>
                        <span class="stat-label">Nhi√™n li·ªáu</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value">{{ trackingData().totalDistance }}</span>
                        <span class="stat-unit">km</span>
                        <span class="stat-label">Qu√£ng ƒë∆∞·ªùng</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value">{{ trackingData().estimatedArrival }}</span>
                        <span class="stat-unit"></span>
                        <span class="stat-label">D·ª± ki·∫øn ƒë·∫øn</span>
                    </div>
                </div>

                <!-- Route -->
                <div class="route-section">
                    <div class="route-header">ƒê∆†N H√ÄNG HI·ªÜN T·∫†I</div>
                    <div class="route-item pickup">
                        <div class="route-dot"></div>
                        <div class="route-info">
                            <span class="route-type">Kho xu·∫•t ph√°t ‚Ä¢ 08:00</span>
                            <span class="route-address">{{ trackingData().pickupLocation }}</span>
                        </div>
                    </div>
                    <div class="route-item current">
                        <div class="route-dot"></div>
                        <div class="route-info">
                            <span class="route-type">ƒêang di chuy·ªÉn</span>
                            <span class="route-address">{{ trackingData().currentLocation }}</span>
                        </div>
                    </div>
                    <div class="route-item delivery">
                        <div class="route-dot"></div>
                        <div class="route-info">
                            <span class="route-type">Giao h√†ng ‚Ä¢ 15:15</span>
                            <span class="route-address">{{ trackingData().deliveryLocation }}</span>
                        </div>
                    </div>
                </div>
                }

                @if (activeTab() === 'orders') {
                <div class="orders-list">
                    @for (order of currentOrders(); track order.id) {
                    <div class="order-item">
                        <div class="order-id">{{ order.id }}</div>
                        <div class="order-dest">{{ order.destination }}</div>
                        <app-status-badge [label]="order.status === 'in_transit' ? 'ƒêang giao' : 'Ch·ªù giao'"
                            [variant]="order.status === 'in_transit' ? 'info' : 'warning'" size="small" />
                    </div>
                    }
                </div>
                }

                @if (activeTab() === 'history') {
                <div class="history-empty">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                    <p>L·ªãch tr√¨nh s·∫Ω hi·ªÉn th·ªã khi t√≠ch h·ª£p GPS</p>
                </div>
                }
            </div>

            <!-- Actions -->
            <div class="panel-actions">
                <button class="btn btn-outline">L·ªãch s·ª≠</button>
                <button class="btn btn-primary">Li√™n h·ªá</button>
            </div>
        </div>
    </div>
</div>